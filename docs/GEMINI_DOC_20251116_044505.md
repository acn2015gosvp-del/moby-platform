Loaded cached credentials.

# MOBY Alert Engine ?쒕퉬???붿옄??由щ럭

**臾몄꽌 踰꾩쟾: 1.0**
**?묒꽦?? 2025-11-16**
**由щ럭 ????뚯씪:**
- `alert_engine.py`
- `anomaly_vector_service.py`
- `alerts_summary.py`

---

## 1. Alert Engine ?꾩껜 ?먮쫫

MOBY ?뚮옯?쇱쓽 Alert Engine? ?쇱꽌 ?곗씠?곕줈遺???댁긽 吏뺥썑瑜?媛먯??섍퀬, ?대? ?뺥삎?붾맂 ?뚮┝(Alert)?쇰줈 ?앹꽦?섎뒗 ?듭떖 諛깆뿏???쒕퉬?ㅼ엯?덈떎. ?꾩껜?곸씤 ?곗씠???먮쫫怨?而댄룷?뚰듃 媛??곹샇?묒슜? ?ㅼ쓬怨?媛숈뒿?덈떎.

1.  **?낅젰 (Input):** ?몃? ?쒖뒪???? MQTT 釉뚮줈而? API ?붾뱶?ъ씤???쇰줈遺???뚮┝ ?됯????꾩슂???곗씠?곌? `Dict` ?뺥깭濡?`alert_engine.process_alert` ?⑥닔???꾨떖?⑸땲??
    -   **二쇱슂 ?곗씠??** `sensor_id`, `vector` (?ㅼ감???쇱꽌 媛?, `threshold` (?⑥씪 ?꾧퀎媛? ?먮뒗 `warning_threshold`/`critical_threshold` (?ㅻ떒怨??꾧퀎媛?, `message` ??

2.  **?낅젰 ?곗씠??寃利?(Validation):**
    -   `alert_engine.py`??`AlertInputModel` (Pydantic 紐⑤뜽)???낅젰 ?곗씠?곗쓽 ?좏슚?깆쓣 寃利앺빀?덈떎.
    -   ?꾩닔 ?꾨뱶(?? `vector`)??議댁옱 ?щ?, ?곗씠????? ?꾧퀎媛??ㅼ젙 洹쒖튃 ?깆쓣 ?뺤씤?섏뿬 ?섎せ???붿껌??議곌린??李⑤떒?⑸땲??

3.  **?댁긽 ?먯? ?됯? (Anomaly Evaluation):**
    -   寃利앸맂 ?곗씠?곕뒗 `anomaly_vector_service.py`濡??꾨떖?⑸땲??
    -   `calculate_vector_norm` ?⑥닔媛 ?낅젰??`vector`??L2 Norm(?좏겢由щ뱶 嫄곕━)??怨꾩궛?⑸땲?? ??`norm` 媛믪? ?뺤긽 ?곹깭濡쒕??곗쓽 ?댄깉 ?뺣룄瑜??섑??대뒗 ?⑥씪 ?ㅼ뭡??媛믪엯?덈떎.
    -   怨꾩궛??`norm` 媛믨낵 ?낅젰???꾧퀎媛?????`check_threshold_with_severity` ?먮뒗 `check_threshold` ?⑥닔瑜??듯빐 鍮꾧탳?⑸땲??
    -   **?됯? 寃곌낵:** `is_anomaly` (boolean)? `severity` (?ш컖?? "normal", "warning", "critical")媛 寃곗젙?⑸땲??

4.  **?뚮┝ ?앹꽦 ?щ? 寃곗젙 (Decision):**
    -   `alert_engine`? `anomaly_vector_service`濡쒕???諛쏆? ?됯? 寃곌낵瑜??뺤씤?⑸땲??
    -   `is_anomaly`媛 `False`?닿굅??`severity`媛 "normal"??寃쎌슦, ?뚮┝ ?앹꽦 ?덉감瑜?以묐떒?섍퀬 "?뺤긽"?쇰줈 ?먮떒?섏뿬 醫낅즺?⑸땲??

5.  **?뚮┝ ?섏씠濡쒕뱶 ?앹꽦 (Payload Generation):**
    -   ?댁긽??媛먯??섎㈃, `alert_engine`? `AlertPayloadModel` (Pydantic 紐⑤뜽) ?뺤떇??留욎떠 ?쒖??붾맂 ?뚮┝ ?섏씠濡쒕뱶瑜?援ъ꽦?⑸땲??
    -   **二쇱슂 ?꾨뱶:** `id`, `level` (UI???뚮┝ ?깃툒), `message`, `sensor_id`, `ts` (??꾩뒪?ы봽), 洹몃━怨??곸꽭 ?뺣낫瑜??대뒗 `details` 媛앹껜 (vector, norm, threshold, severity ???ы븿).

6.  **LLM 湲곕컲 ?붿빟 (LLM Summary - Optional):**
    -   ?낅젰 ?곗씠?곗뿉??`enable_llm_summary`媛 `True`濡??ㅼ젙??寃쎌슦, ?앹꽦???뚮┝ ?섏씠濡쒕뱶??`alerts_summary.py`??`generate_alert_summary` ?⑥닔濡??꾨떖?⑸땲??
    -   ???⑥닔??`llm_client`瑜??몄텧?섏뿬 ?뚮┝ ?곗씠?곗쓽 留λ씫???멸컙???댄빐?섍린 ?ъ슫 ?먯뿰??臾몄옣?쇰줈 ?붿빟?⑸땲??
    -   ?앹꽦???붿빟臾몄? ?뚮┝ ?섏씠濡쒕뱶??`llm_summary` ?꾨뱶??異붽??⑸땲??

7.  **理쒖쥌 異쒕젰 (Output):**
    -   紐⑤뱺 ?덉감瑜?留덉튇 理쒖쥌 ?뚮┝ ?섏씠濡쒕뱶(`AlertPayloadModel` 媛앹껜)媛 `process_alert` ?⑥닔??諛섑솚 媛믪쑝濡?異쒕젰?⑸땲??
    -   ???섏씠濡쒕뱶???곸쐞 ?쒕퉬???? Notifier)濡??꾨떖?섏뼱 WebSocket, Slack, ?대찓?????ㅼ뼇??梨꾨꼸???듯빐 ?ъ슜?먯뿉寃??꾩넚?⑸땲??

---

## 2. 踰≫꽣 湲곕컲 ?댁긽 ?먯? (Norm, Threshold, Severity)

蹂??쒖뒪?쒖쓽 ?댁긽 ?먯????ㅼ감??踰≫꽣(Vector)瑜?湲곕컲?쇰줈 ?⑸땲?? 媛??쇱꽌??二쇱슂 ?뱀쭠(feature)?ㅼ씠 踰≫꽣????李⑥썝??援ъ꽦?섎ŉ, ??踰≫꽣媛 ?뺤긽 ?곹깭???먯젏(origin)?먯꽌 ?쇰쭏??踰쀬뼱?щ뒗吏瑜?痢≪젙?섏뿬 ?댁긽 ?щ?瑜??먮떒?⑸땲??

-   **Anomaly Vector (?댁긽 踰≫꽣):**
    -   ?쇱꽌???щ윭 痢≪젙媛??? 吏꾨룞 RMS, 二쇳뙆???쇳겕, ?⑤룄 ?????뺢퇋??normalize)?섍굅???뱀쭠??異붿텧?섏뿬 援ъ꽦???ㅼ감??諛곗뿴(?? `[0.1, -0.5, 1.2]`)?낅땲??
    -   踰≫꽣??媛??붿냼???뱀젙 ?곹깭???몄감瑜??섑??낅땲??

-   **Norm (??:**
    -   踰≫꽣??'?ш린' ?먮뒗 '湲몄씠'瑜??섎??섎ŉ, 蹂??쒖뒪?쒖뿉?쒕뒗 **L2 Norm (?좏겢由щ뱶 嫄곕━)**???ъ슜?⑸땲??
    -   怨꾩궛?? `sqrt(v1^2 + v2^2 + ... + vn^2)`
    -   `norm` 媛믪? 紐⑤뱺 李⑥썝???몄감瑜?醫낇빀???⑥씪 媛믪쑝濡? **?뺤긽 ?곹깭(?먯젏)濡쒕??곗쓽 珥??댄깉 嫄곕━**瑜??섎??⑸땲?? `norm`???댁닔濡??댁긽 ?곹깭???뺣쪧???믪뒿?덈떎.

-   **Threshold (?꾧퀎媛?:**
    -   `norm` 媛믪씠 ??媛믪쓣 珥덇낵?섎㈃ '?댁긽'?쇰줈 ?먮떒?섎뒗 湲곗??좎엯?덈떎.
    -   **?⑥씪 ?꾧퀎媛?** ?섎굹??`threshold` 媛믪쑝濡??댁긽/?뺤긽??援щ텇?⑸땲??
    -   **?ㅻ떒怨??꾧퀎媛?** `warning_threshold`? `critical_threshold` ??媛쒖쓽 ?꾧퀎媛믪쓣 ?먯뼱 ?곹깭瑜??몃텇?뷀빀?덈떎.

-   **Severity (?ш컖??:**
    -   `norm` 媛믪씠 ?대뒓 ?꾧퀎媛?援ш컙???랁븯?붿????곕씪 寃곗젙?섎뒗 ?댁긽 ?곹깭???ш컖 ?섏??낅땲??
    -   `norm <= warning_threshold`: **"normal"**
    -   `warning_threshold < norm <= critical_threshold`: **"warning"** (寃쎄퀬)
    -   `norm > critical_threshold`: **"critical"** (?ш컖)
    -   ???ш컖?꾨뒗 ?뚮┝???곗꽑?쒖쐞, UI ?쒖떆 ?됱긽(`level`), ?뚮┝ ?꾩넚 ????깆쓣 寃곗젙?섎뒗 ???ъ슜?⑸땲??

---

## 3. 由ы뙥?좊쭅??援ъ“??媛뺤젏

?꾩옱??3媛??쒕퉬??`alert_engine`, `anomaly_vector_service`, `alerts_summary`)濡?遺꾨━??援ъ“???ㅼ쓬怨?媛숈? 媛뺤젏??媛吏묐땲??

1.  **愿?ъ궗 遺꾨━ (Separation of Concerns):**
    -   **`anomaly_vector_service`:** ?쒖닔???섑븰??怨꾩궛(norm, threshold 鍮꾧탳)留??대떦?⑸땲??
    -   **`alerts_summary`:** LLM ?곕룞 諛??꾨＼?꾪듃 ?붿??덉뼱留곸뿉留?吏묒쨷?⑸땲??
    -   **`alert_engine`:** ?꾩껜 ?먮쫫??議곗쑉(Orchestration)?섍퀬, ?곗씠??援ъ“瑜??뺤쓽?섎ŉ, 鍮꾩쫰?덉뒪 濡쒖쭅??泥섎━?⑸땲??
    -   媛?紐⑤뱢????븷??紐낇솗?댁졇 肄붾뱶 ?댄빐? ?좎?蹂댁닔媛 ?⑹씠?⑸땲??

2.  **?뚯뒪???⑹씠??(Testability):**
    -   媛??쒕퉬?ㅻ? ?낅┰?곸쑝濡??좊떅 ?뚯뒪?명븷 ???덉뒿?덈떎. ?덈? ?ㅼ뼱, `anomaly_vector_service`??LLM?대굹 ?곗씠?곕쿋?댁뒪 ?섏〈???놁씠 ?쒖닔 ?⑥닔濡??뚯뒪?멸? 媛?ν빀?덈떎.
    -   `alert_engine`? ?ㅻⅨ ?쒕퉬?ㅻ뱾??Mocking?섏뿬 鍮꾩쫰?덉뒪 濡쒖쭅???뺥솗?깆쓣 寃利앺븯湲??쎌뒿?덈떎.

3.  **?뺤옣??諛??좎뿰??(Extensibility & Flexibility):**
    -   **?ㅻⅨ ?댁긽 ?먯? 紐⑤뜽 異붽?:** L2 Norm ?몄뿉 ?ㅻⅨ 諛⑹떇(?? Mahalanobis 嫄곕━, Autoencoder 湲곕컲)???댁긽 ?먯? 濡쒖쭅??`anomaly_vector_service`???덈줈???⑥닔濡?異붽??섍굅?? ?쒕퉬?ㅻ? 援먯껜?섍린 ?⑹씠?⑸땲?? `alert_engine`??蹂寃쎌? 理쒖냼?붾맗?덈떎.
    -   **LLM 援먯껜:** `alerts_summary` ?대?留??섏젙?섎㈃ ?ㅻⅨ LLM(?? Claude, Llama)?쇰줈 ?쎄쾶 援먯껜?????덉뒿?덈떎.
    -   **?뚮┝ ?섏씠濡쒕뱶 蹂寃?** `alert_engine.py`??Pydantic 紐⑤뜽留??섏젙?섎㈃ ?꾩껜 ?쒖뒪?쒖뿉 ?쇨????뚮┝ 援ъ“瑜??곸슜?????덉뒿?덈떎.

4.  **肄붾뱶 媛?낆꽦 諛??덉젙??(Readability & Stability):**
    -   Pydantic 紐⑤뜽???ъ슜?⑥쑝濡쒖뜥 ?곗씠?곗쓽 ?뺥깭? ?쒖빟議곌굔??肄붾뱶濡?紐낇솗?섍쾶 臾몄꽌?붾맗?덈떎.
    -   ?고??꾩뿉 ?곗씠????낆쓣 媛뺤젣?섏뿬 ?덇린移??딆? `None` 媛믪씠???섎せ???곗씠????낆쑝濡??명븳 ?ㅻ쪟瑜??ъ쟾??諛⑹??⑸땲??

---

## 4. 媛쒖꽑 ?ъ씤??(TODO 紐⑸줉)

-   **[Config] ?꾧퀎媛??몃? ?ㅼ젙??**
    -   ?꾩옱 肄붾뱶???섎뱶肄붾뵫?????덈뒗 ?꾧퀎媛믩뱾??蹂꾨룄???ㅼ젙 ?뚯씪(`config.py` ?먮뒗 `.env`, YAML)濡?遺꾨━?섏뿬, 肄붾뱶 ?섏젙 ?놁씠 ?숈쟻?쇰줈 ?꾧퀎媛믪쓣 蹂寃쏀븷 ???덈룄濡?媛쒖꽑?댁빞 ?⑸땲??

-   **[Model] ?숈쟻/?곸쓳???꾧퀎媛?(Dynamic/Adaptive Threshold):**
    -   ?쇱꽌???곹깭???몃? ?섍꼍???곕씪 理쒖쟻???꾧퀎媛믪씠 ?щ씪吏????덉뒿?덈떎. 怨쇨굅 ?곗씠???⑦꽩???숈뒿?섏뿬 ?꾧퀎媛믪쓣 ?먮룞?쇰줈 議곗젙?섎뒗 湲곕뒫??異붽??섎㈃ ?먯? ?뺥솗?꾨? ?믪씪 ???덉뒿?덈떎.

-   **[Feature] 洹쇰낯 ?먯씤 遺꾩꽍 (Root Cause Analysis) 吏??**
    -   `norm` 媛믪씠 ?믪쓣 ?? 踰≫꽣???대뼡 ?붿냼(李⑥썝)媛 媛???ш쾶 湲곗뿬?덈뒗吏 遺꾩꽍?섎뒗 濡쒖쭅??異붽??????덉뒿?덈떎. (?? `details` ?꾨뱶??`contributing_factors: {"temp": 0.8, "vibration_rms": 0.2}` 異붽?) ?대뒗 ?댁쁺?먭? 臾몄젣???먯씤???뚯븙?섎뒗 ?????꾩????⑸땲??

-   **[Performance] 諛곗튂 泥섎━ 理쒖쟻??**
    -   `alerts_summary.py`??`generate_summary_batch`???⑥닚 諛섎났臾몄쑝濡?援ы쁽?섏뼱 ?덉뒿?덈떎. LLM API媛 諛곗튂 ?붿껌??吏?먰븳?ㅻ㈃, ?щ윭 ?뚮┝???섎굹???붿껌?쇰줈 臾띠뼱 泥섎━?섏뿬 ?ㅽ듃?뚰겕 ?ㅻ쾭?ㅻ뱶? 泥섎━ ?쒓컙??以꾩씪 ???덉뒿?덈떎.

-   **[Logging] ?곸꽭 濡쒓퉭 媛뺥솕:**
    -   `alerts_summary.py`???덉쇅 泥섎━ 遺遺꾩뿉 `logger`瑜??ъ슜???곸꽭 濡쒓퉭???꾩슂?⑸땲??
    -   ?뺤긽?곸쑝濡?泥섎━?섏뿀吏留??뚮┝???앹꽦?섏? ?딆? 寃쎌슦(Anomaly-Not-Found)????댁꽌??`INFO` ?덈꺼??濡쒓렇瑜??④꺼, ?쒖뒪???숈옉??異붿쟻?섍린 ?⑹씠?섍쾶 留뚮뱾硫?醫뗭뒿?덈떎. (?꾩옱 援ы쁽??

-   **[Extensibility] ?뚮윭洹몄씤 ?꾪궎?띿쿂 ?꾩엯:**
    -   ?κ린?곸쑝濡?`anomaly_vector_service`瑜??뚮윭洹몄씤 ?뺥깭濡??ㅺ퀎?섏뿬, ?ㅼ뼇???댁긽 ?먯? ?뚭퀬由ъ쬁???쎄쾶 異붽??섍퀬 援먯껜?????덈뒗 援ъ“瑜?怨좊젮?대낵 ???덉뒿?덈떎.
